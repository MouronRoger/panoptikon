============================= test session starts ==============================
platform darwin -- Python 3.9.18, pytest-8.3.5, pluggy-1.5.0 -- /Users/james/Documents/GitHub/panoptikon/.venv/bin/python
cachedir: .pytest_cache
rootdir: /Users/james/Documents/GitHub/panoptikon
configfile: pyproject.toml
testpaths: tests
plugins: anyio-4.9.0, asyncio-0.26.0, mock-3.14.0, cov-6.1.1
asyncio: mode=strict, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collecting ... collected 313 items

tests/core/test_bookmarks.py::TestBookmarkDataClass::test_bookmark_creation PASSED [  0%]
tests/core/test_bookmarks.py::TestBookmarkServiceBasics::test_initialization PASSED [  0%]
tests/core/test_bookmarks.py::TestBookmarkServiceBasics::test_shutdown PASSED [  0%]
tests/core/test_bookmarks.py::TestBookmarkServiceBasics::test_has_bookmark PASSED [  1%]
tests/core/test_bookmarks.py::TestBookmarkServiceBasics::test_is_valid PASSED [  1%]
tests/core/test_bookmarks.py::TestBookmarkServiceBasics::test_get_bookmarked_paths PASSED [  1%]
tests/core/test_bookmarks.py::TestBookmarkStorage::test_path_to_filename PASSED [  2%]
tests/core/test_bookmarks.py::TestBookmarkStorage::test_save_and_read_bookmark PASSED [  2%]
tests/core/test_bookmarks.py::TestBookmarkStorage::test_remove_bookmark PASSED [  2%]
tests/core/test_bookmarks.py::TestBookmarkStorage::test_remove_bookmark_with_active_access PASSED [  3%]
tests/core/test_bookmarks.py::TestBookmarkStorage::test_load_bookmarks PASSED [  3%]
tests/core/test_bookmarks.py::TestMacOSBookmarkOperations::test_create_bookmark PASSED [  3%]
tests/core/test_bookmarks.py::TestMacOSBookmarkOperations::test_create_bookmark_error PASSED [  4%]
tests/core/test_bookmarks.py::TestMacOSBookmarkOperations::test_start_access PASSED [  4%]
tests/core/test_bookmarks.py::TestMacOSBookmarkOperations::test_start_access_no_bookmark PASSED [  4%]
tests/core/test_bookmarks.py::TestMacOSBookmarkOperations::test_start_access_already_active PASSED [  5%]
tests/core/test_bookmarks.py::TestMacOSBookmarkOperations::test_stop_access PASSED [  5%]
tests/core/test_bookmarks.py::TestMacOSBookmarkOperations::test_stop_access_not_active PASSED [  5%]
tests/core/test_bookmarks.py::TestMacOSBookmarkOperations::test_verify_bookmark PASSED [  6%]
tests/core/test_bootstrap.py::test_system_bootstrap_and_minimal_flow PASSED [  6%]
tests/core/test_cloud_storage.py::TestCloudProviderDetectorAdvanced::test_initialize_providers_non_existent_paths PASSED [  6%]
tests/core/test_cloud_storage.py::TestCloudProviderDetectorAdvanced::test_check_provider_online_exceptions PASSED [  7%]
tests/core/test_cloud_storage.py::TestCloudProviderDetectorAdvanced::test_detect_provider_path_variants PASSED [  7%]
tests/core/test_cloud_storage.py::TestCloudProviderDetectorAdvanced::test_detect_provider_macos_private_prefix PASSED [  7%]
tests/core/test_cloud_storage.py::TestCloudProviderDetectorAdvanced::test_refresh_provider_status PASSED [  7%]
tests/core/test_cloud_storage.py::TestCloudProviderDetectorAdvanced::test_initialize_providers_mac_real_paths PASSED [  8%]
tests/core/test_cloud_storage.py::TestCloudProviderDetectorAdvanced::test_detect_provider_real_paths PASSED [  8%]
tests/core/test_cloud_storage.py::TestCloudStorageServiceAdvanced::test_initialize_publishes_events PASSED [  8%]
tests/core/test_cloud_storage.py::TestCloudStorageServiceAdvanced::test_get_provider_for_path_caching PASSED [  9%]
tests/core/test_cloud_storage.py::TestCloudStorageServiceAdvanced::test_get_provider_for_path_cache_limit PASSED [  9%]
tests/core/test_cloud_storage.py::TestCloudStorageServiceAdvanced::test_is_cloud_path PASSED [  9%]
tests/core/test_cloud_storage.py::TestCloudStorageServiceAdvanced::test_get_provider_type PASSED [ 10%]
tests/core/test_cloud_storage.py::TestCloudStorageServiceAdvanced::test_is_provider_online PASSED [ 10%]
tests/core/test_cloud_storage.py::TestCloudStorageServiceAdvanced::test_refresh_provider_status_publishes_events PASSED [ 10%]
tests/core/test_cloud_storage.py::TestCloudStorageServiceAdvanced::test_get_all_providers PASSED [ 11%]
tests/core/test_config.py::test_initialization PASSED                    [ 11%]
tests/core/test_config.py::test_register_section PASSED                  [ 11%]
tests/core/test_config.py::test_set_config_value PASSED                  [ 12%]
tests/core/test_config.py::test_update_section PASSED                    [ 12%]
tests/core/test_config.py::test_save_and_reload PASSED                   [ 12%]
tests/core/test_config.py::test_reset_to_defaults PASSED                 [ 13%]
tests/core/test_config.py::test_error_handling PASSED                    [ 13%]
tests/core/test_config_hot_reload.py::test_config_validation PASSED      [ 13%]
tests/core/test_config_hot_reload.py::test_get_as_model_validation PASSED [ 14%]
tests/core/test_config_hot_reload.py::test_config_file_error_handling PASSED [ 14%]
tests/core/test_config_hot_reload.py::test_load_invalid_config_file PASSED [ 14%]
tests/core/test_config_hot_reload.py::test_hot_reload PASSED             [ 15%]
tests/core/test_config_hot_reload.py::test_emit_config_change_events PASSED [ 15%]
tests/core/test_config_hot_reload.py::test_windows_config_dir SKIPPED    [ 15%]
tests/core/test_config_hot_reload.py::test_config_dir_detection PASSED   [ 15%]
tests/core/test_config_hot_reload.py::test_file_watching PASSED          [ 16%]
tests/core/test_config_hot_reload.py::test_config_changed_event_validation PASSED [ 16%]
tests/core/test_database_connection.py::test_connection_init PASSED      [ 16%]
tests/core/test_database_connection.py::test_connect PASSED              [ 17%]
tests/core/test_database_connection.py::test_transaction PASSED          [ 17%]
tests/core/test_database_connection.py::test_close PASSED                [ 17%]
tests/core/test_database_connection.py::test_execute PASSED              [ 18%]
tests/core/test_database_connection.py::test_execute_many PASSED         [ 18%]
tests/core/test_database_connection.py::test_thread_safety PASSED        [ 18%]
tests/core/test_database_schema.py::test_schema_manager_init PASSED      [ 19%]
tests/core/test_database_schema.py::test_database_exists PASSED          [ 19%]
tests/core/test_database_schema.py::test_create_schema PASSED            [ 19%]
tests/core/test_database_schema.py::test_create_schema_directory_error PASSED [ 20%]
tests/core/test_database_schema.py::test_validate_schema PASSED          [ 20%]
tests/core/test_database_schema.py::test_validate_schema_version PASSED  [ 20%]
tests/core/test_database_schema.py::test_get_schema_version PASSED       [ 21%]
tests/core/test_database_schema.py::test_validate_schema_error PASSED    [ 21%]
tests/core/test_database_schema.py::test_check_version_compatibility PASSED [ 21%]
tests/core/test_database_schema.py::test_migrate_to_latest_adds_folder_size PASSED [ 22%]
tests/core/test_database_schema.py::test_migrate_to_latest_idempotent PASSED [ 22%]
tests/core/test_database_schema.py::test_migrate_to_latest_noop_on_1_1_0 PASSED [ 22%]
tests/core/test_database_schema.py::test_set_and_get_schema_version PASSED [ 23%]
tests/core/test_database_schema.py::test_compare_schema_version PASSED   [ 23%]
tests/core/test_database_schema.py::test_find_migrations_sequential PASSED [ 23%]
tests/core/test_database_schema.py::test_find_migrations_no_path PASSED  [ 23%]
tests/core/test_database_schema.py::test_registry_extensible PASSED      [ 24%]
tests/core/test_database_schema.py::test_backup_database_creates_file PASSED [ 24%]
tests/core/test_database_schema.py::test_backup_database_skips_if_missing PASSED [ 24%]
tests/core/test_database_schema.py::test_restore_database_restores_file PASSED [ 25%]
tests/core/test_database_schema.py::test_migration_executor_success PASSED [ 25%]
tests/core/test_database_schema.py::test_migration_executor_failure_and_rollback PASSED [ 25%]
tests/core/test_database_service.py::test_database_service_init PASSED   [ 26%]
tests/core/test_database_service.py::test_database_service_initialize PASSED [ 26%]
tests/core/test_database_service.py::test_database_service_shutdown PASSED [ 26%]
tests/core/test_database_service.py::test_database_service_get_connection PASSED [ 27%]
tests/core/test_database_service.py::test_database_service_execute PASSED [ 27%]
tests/core/test_database_service.py::test_database_service_execute_many PASSED [ 27%]
tests/core/test_database_service.py::test_database_service_properties PASSED [ 28%]
tests/core/test_db_pool.py::test_pool_initialization PASSED              [ 28%]
tests/core/test_db_pool.py::test_pool_get_connection PASSED              [ 28%]
tests/core/test_db_pool.py::test_pool_connection_reuse PASSED            [ 29%]
tests/core/test_db_pool.py::test_pool_max_connections PASSED             [ 29%]
tests/core/test_db_pool.py::test_pool_connection_health_check PASSED     [ 29%]
tests/core/test_db_pool.py::test_pool_connection_max_age PASSED          [ 30%]
tests/core/test_db_pool.py::test_pool_transaction PASSED                 [ 30%]
tests/core/test_db_pool.py::test_pool_different_isolation_levels PASSED  [ 30%]
tests/core/test_db_pool.py::test_pool_savepoint PASSED                   [ 30%]
tests/core/test_db_pool.py::test_pool_savepoint_context_manager PASSED   [ 31%]
tests/core/test_db_pool.py::test_pool_concurrent_access_param[10] PASSED [ 31%]
tests/core/test_db_pool.py::test_pool_concurrent_access_param[50] PASSED [ 31%]
tests/core/test_db_pool.py::test_pool_concurrent_access_param[100] PASSED [ 32%]
tests/core/test_db_pool.py::test_pool_concurrent_access_param[150] PASSED [ 32%]
tests/core/test_db_pool.py::test_pool_writer_contention PASSED           [ 32%]
tests/core/test_db_pool.py::test_pool_stress_leak_prevention PASSED      [ 33%]
tests/core/test_db_pool.py::test_pool_manager PASSED                     [ 33%]
tests/core/test_db_pool.py::test_pool_thread_safety PASSED               [ 33%]
tests/core/test_db_pool.py::test_connection_health_status PASSED         [ 34%]
tests/core/test_db_pool.py::test_transaction_isolation_level PASSED      [ 34%]
tests/core/test_db_pool.py::test_pooled_connection PASSED                [ 34%]
tests/core/test_db_pool.py::test_pool_invalid_params PASSED              [ 35%]
tests/core/test_db_pool_service.py::test_pool_service_initialization PASSED [ 35%]
tests/core/test_db_pool_service.py::test_pool_service_create_database_if_missing PASSED [ 35%]
tests/core/test_db_pool_service.py::test_pool_service_recreate_schema_if_invalid PASSED [ 36%]
tests/core/test_db_pool_service.py::test_pool_service_fail_if_missing_and_not_create PASSED [ 36%]
tests/core/test_db_pool_service.py::test_pool_service_execute PASSED     [ 36%]
tests/core/test_db_pool_service.py::test_pool_service_execute_many PASSED [ 37%]
tests/core/test_db_pool_service.py::test_pool_service_transaction PASSED [ 37%]
tests/core/test_db_pool_service.py::test_pool_service_savepoint PASSED   [ 37%]
tests/core/test_db_pool_service.py::test_pool_service_get_connection PASSED [ 38%]
tests/core/test_db_pool_service.py::test_pool_service_get_stats PASSED   [ 38%]
tests/core/test_db_pool_service.py::test_pool_service_shutdown PASSED    [ 38%]
tests/core/test_db_pool_service.py::test_pool_service_concurrent_access_integration[10] PASSED [ 38%]
tests/core/test_db_pool_service.py::test_pool_service_concurrent_access_integration[50] PASSED [ 39%]
tests/core/test_db_pool_service.py::test_pool_service_concurrent_access_integration[100] PASSED [ 39%]
tests/core/test_db_pool_service.py::test_pool_service_writer_contention_integration PASSED [ 39%]
tests/core/test_db_pool_service.py::test_pool_service_stress_leak_prevention_integration PASSED [ 40%]
tests/core/test_errors.py::test_error_context PASSED                     [ 40%]
tests/core/test_errors.py::test_application_error PASSED                 [ 40%]
tests/core/test_errors.py::test_specific_errors PASSED                   [ 41%]
tests/core/test_errors.py::test_error_manager_initialization PASSED      [ 41%]
tests/core/test_errors.py::test_error_manager_handlers PASSED            [ 41%]
tests/core/test_errors.py::test_error_manager_recovery PASSED            [ 42%]
tests/core/test_errors.py::test_error_manager_history PASSED             [ 42%]
tests/core/test_errors.py::test_error_manager_exception_conversion PASSED [ 42%]
tests/core/test_errors.py::test_error_manager_handler_inheritance PASSED [ 43%]
tests/core/test_events.py::TestEventBase::test_to_dict PASSED            [ 43%]
tests/core/test_events.py::TestEventBase::test_to_json PASSED            [ 43%]
tests/core/test_events.py::TestErrorEvent::test_validation PASSED        [ 44%]
tests/core/test_events.py::TestErrorEvent::test_to_dict PASSED           [ 44%]
tests/core/test_events.py::TestEventBusBasics::test_initialization PASSED [ 44%]
tests/core/test_events.py::TestEventBusBasics::test_simple_publish_subscribe PASSED [ 45%]
tests/core/test_events.py::TestEventBusBasics::test_multiple_handlers PASSED [ 45%]
tests/core/test_events.py::TestEventBusBasics::test_unsubscribe PASSED   [ 45%]
tests/core/test_events.py::TestEventHistoryManagement::test_event_history_management PASSED [ 46%]
tests/core/test_events.py::TestEventHistoryManagement::test_record_history_setting PASSED [ 46%]
tests/core/test_events.py::TestEventHistoryManagement::test_invalid_history_size PASSED [ 46%]
tests/core/test_events.py::TestEventDelivery::test_priority_ordering PASSED [ 46%]
tests/core/test_events.py::TestEventDelivery::test_error_handling PASSED [ 47%]
tests/core/test_events.py::TestEventDelivery::test_nested_error_handling PASSED [ 47%]
tests/core/test_events.py::TestEventDelivery::test_event_delivery_modes PASSED [ 47%]
tests/core/test_events.py::TestEventDelivery::test_auto_detect_delivery_mode PASSED [ 48%]
tests/core/test_events.py::TestAsyncEventHandling::test_async_handlers PASSED [ 48%]
tests/core/test_events.py::TestAsyncEventHandling::test_no_event_loop_error PASSED [ 48%]
tests/core/test_events.py::TestHandlerTypes::test_callable_handlers PASSED [ 49%]
tests/core/test_events.py::TestHandlerTypes::test_invalid_handler_types PASSED [ 49%]
tests/core/test_events.py::TestHandlerTypes::test_handler_type_checking PASSED [ 49%]
tests/core/test_events.py::TestHandlerTypes::test_deliver_to_correct_handler_types PASSED [ 50%]
tests/core/test_events.py::TestEventInheritance::test_inheritance_subscription PASSED [ 50%]
tests/core/test_events.py::TestEventInheritance::test_event_source_auto_detection PASSED [ 50%]
tests/core/test_filesystem.py::TestFileSystemEvent::test_initialization PASSED [ 51%]
tests/core/test_filesystem.py::TestFileSystemEvent::test_to_dict PASSED  [ 51%]
tests/core/test_filesystem.py::TestFileChangeEvent::test_initialization PASSED [ 51%]
tests/core/test_filesystem.py::TestFileChangeEvent::test_to_dict PASSED  [ 52%]
tests/core/test_filesystem.py::TestOtherEventTypes::test_bookmark_event PASSED [ 52%]
tests/core/test_filesystem.py::TestOtherEventTypes::test_cloud_storage_event PASSED [ 52%]
tests/core/test_filesystem.py::TestOtherEventTypes::test_directory_limit_event PASSED [ 53%]
tests/core/test_filesystem.py::TestOtherEventTypes::test_file_permission_event PASSED [ 53%]
tests/core/test_filesystem.py::TestOtherEventTypes::test_filesystem_error_event PASSED [ 53%]
tests/core/test_filesystem.py::TestOtherEventTypes::test_watched_paths_changed_event PASSED [ 53%]
tests/core/test_filesystem.py::TestFilesystemIntegration::test_file_access_integration PASSED [ 54%]
tests/core/test_filesystem.py::TestFilesystemIntegration::test_macos_symlink_resolution PASSED [ 54%]
tests/core/test_filesystem.py::TestFilesystemIntegration::test_path_manager_integration PASSED [ 54%]
tests/core/test_filesystem.py::TestFilesystemComponentIntegration::test_watcher_events_path_manager PASSED [ 55%]
tests/core/test_filesystem.py::TestFilesystemComponentIntegration::test_access_bookmarks_cloud_detection PASSED [ 55%]
tests/core/test_filesystem.py::TestFilesystemComponentIntegration::test_full_permission_flow PASSED [ 55%]
tests/core/test_filesystem_access.py::TestBasicFileOperations::test_can_read_existing_file PASSED [ 56%]
tests/core/test_filesystem_access.py::TestBasicFileOperations::test_can_write_existing_file PASSED [ 56%]
tests/core/test_filesystem_access.py::TestBasicFileOperations::test_read_file_contents PASSED [ 56%]
tests/core/test_filesystem_access.py::TestBasicFileOperations::test_write_file_contents PASSED [ 57%]
tests/core/test_filesystem_access.py::TestBasicFileOperations::test_create_directory PASSED [ 57%]
tests/core/test_filesystem_access.py::TestBasicFileOperations::test_delete_file PASSED [ 57%]
tests/core/test_filesystem_access.py::TestBasicFileOperations::test_move_file PASSED [ 58%]
tests/core/test_filesystem_access.py::TestFileOperationHandlers::test_standard_write_file_not_exists PASSED [ 58%]
tests/core/test_filesystem_access.py::TestFileOperationHandlers::test_standard_delete_non_existent PASSED [ 58%]
tests/core/test_filesystem_access.py::TestFileOperationHandlers::test_standard_rename_non_existent PASSED [ 59%]
tests/core/test_filesystem_access.py::TestFileOperationHandlers::test_standard_read_permission_error PASSED [ 59%]
tests/core/test_filesystem_access.py::TestFileOperationHandlers::test_standard_write_permission_error PASSED [ 59%]
tests/core/test_filesystem_access.py::TestFileOperationHandlers::test_standard_delete_permission_error PASSED [ 60%]
tests/core/test_filesystem_access.py::TestFileOperationHandlers::test_standard_rename_permission_error PASSED [ 60%]
tests/core/test_filesystem_access.py::TestFileOperationHandlers::test_standard_move_permission_error PASSED [ 60%]
tests/core/test_filesystem_access.py::TestFileOperationHandlers::test_standard_create_permission_error PASSED [ 61%]
tests/core/test_filesystem_access.py::TestFileOperationHandlers::test_standard_metadata_permission_error PASSED [ 61%]
tests/core/test_filesystem_access.py::TestFileOperationHandlers::test_get_operation_handler_fallback PASSED [ 61%]
tests/core/test_filesystem_access.py::TestFileOperationHandlers::test_get_operation_handler_not_found PASSED [ 61%]
tests/core/test_filesystem_access.py::TestFileOperationHandlers::test_cloud_operation_not_implemented_logs_warning PASSED [ 62%]
tests/core/test_filesystem_access.py::TestFileOperationHandlers::test_handle_access_denied_silent_fail PASSED [ 62%]
tests/core/test_filesystem_access.py::TestFileOperationHandlers::test_handle_access_denied_other_strategies_publishes_event PASSED [ 62%]
tests/core/test_filesystem_access.py::TestFileOperationHandlers::test_request_access_user_prompt PASSED [ 63%]
tests/core/test_filesystem_access.py::TestFileOperationHandlers::test_request_access_silent_fail PASSED [ 63%]
tests/core/test_filesystem_access.py::TestAccessRequestHandling::test_get_operation_handler_cloud_provider PASSED [ 63%]
tests/core/test_filesystem_access.py::TestAccessRequestHandling::test_handle_bookmark_access_not_needed PASSED [ 64%]
tests/core/test_filesystem_access.py::TestAccessRequestHandling::test_handle_bookmark_access_macos_home PASSED [ 64%]
tests/core/test_filesystem_access.py::TestBookmarkIntegration::test_bookmark_integration PASSED [ 64%]
tests/core/test_filesystem_watcher.py::TestFSWatcherBase::test_abstract_methods PASSED [ 65%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_initialization PASSED [ 65%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_start_stop PASSED [ 65%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_add_remove_watch PASSED [ 66%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_detect_file_creation PASSED [ 66%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_add_watch_nonexistent_path_logs_warning PASSED [ 66%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_remove_watch_nonexistent_path_logs_debug PASSED [ 67%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_double_add_watch_logs_debug PASSED [ 67%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_double_remove_watch_logs_debug PASSED [ 67%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_refresh_watch_state_permission_error PASSED [ 68%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_scan_directory_permission_error PASSED [ 68%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_handle_deleted_path_emits_events PASSED [ 68%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_thread_cleanup_on_stop PASSED [ 69%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_recursive_vs_nonrecursive_watch PASSED [ 69%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_fsevents_importerror PASSED [ 69%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_filesystemwatchservice_fallback_to_polling PASSED [ 69%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_watch_thread_error_handling PASSED [ 70%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_process_new_and_modified_files PASSED [ 70%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_process_deleted_files PASSED [ 70%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_emit_file_event PASSED [ 71%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_double_start_stop PASSED [ 71%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_filesystemwatchservice_configure_switch_types PASSED [ 71%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_filesystemwatchservice_start_stop_edge_cases PASSED [ 72%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_filesystemwatchservice_add_remove_watch_edge_cases PASSED [ 72%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_filesystemwatchservice_create_watcher_error_fallback PASSED [ 72%]
tests/core/test_filesystem_watcher.py::TestPollingWatcher::test_fseventswatcher_add_remove_watch_error PASSED [ 73%]
tests/core/test_filesystem_watcher.py::TestFSEventsWatcher::test_initialization SKIPPED [ 73%]
tests/core/test_filesystem_watcher.py::TestFSEventsWatcher::test_start_stop SKIPPED [ 73%]
tests/core/test_filesystem_watcher.py::TestFSEventsWatcher::test_add_remove_watch SKIPPED [ 74%]
tests/core/test_filesystem_watcher.py::TestFileSystemWatchService::test_initialization PASSED [ 74%]
tests/core/test_filesystem_watcher.py::TestFileSystemWatchService::test_add_watch PASSED [ 74%]
tests/core/test_filesystem_watcher.py::TestFileSystemWatchService::test_remove_watch PASSED [ 75%]
tests/core/test_integration.py::test_core_integration[EventBus-EventBase-core] PASSED [ 75%]
tests/core/test_integration.py::test_core_integration[EventBus-EventBase-patched] PASSED [ 75%]
tests/core/test_lifecycle.py::test_lifecycle_initialization PASSED       [ 76%]
tests/core/test_lifecycle.py::test_startup_hook_registration PASSED      [ 76%]
tests/core/test_lifecycle.py::test_shutdown_hook_registration PASSED     [ 76%]
tests/core/test_lifecycle.py::test_state_transitions PASSED              [ 76%]
tests/core/test_lifecycle.py::test_shutdown_request PASSED               [ 77%]
tests/core/test_lifecycle.py::test_wait_for_shutdown_timeout PASSED      [ 77%]
tests/core/test_lifecycle.py::test_hook_error_handling PASSED            [ 77%]
tests/core/test_lifecycle.py::test_invalid_state_transitions PASSED      [ 78%]
tests/core/test_lifecycle.py::test_service_initialization PASSED         [ 78%]
tests/core/test_paths.py::TestPathManager::test_is_subpath PASSED        [ 78%]
tests/core/test_paths.py::TestPathManager::test_normalize_path PASSED    [ 79%]
tests/core/test_paths.py::TestPathManager::test_path_rule_matching PASSED [ 79%]
tests/core/test_paths.py::TestPathManager::test_path_rule_set PASSED     [ 79%]
tests/core/test_paths.py::TestPathManager::test_path_rule_set_includes_and_excludes PASSED [ 80%]
tests/core/test_paths.py::TestPathManager::test_paths_equal PASSED       [ 80%]
tests/core/test_paths.py::TestPathManager::test_rule_match_types PASSED  [ 80%]
tests/core/test_paths.py::TestPathManager::test_rule_set_management PASSED [ 81%]
tests/core/test_service.py::test_registration_and_resolution PASSED      [ 81%]
tests/core/test_service.py::test_singleton_lifecycle PASSED              [ 81%]
tests/core/test_service.py::test_transient_lifecycle PASSED              [ 82%]
tests/core/test_service.py::test_factory_registration PASSED             [ 82%]
tests/core/test_service.py::test_dependency_injection PASSED             [ 82%]
tests/core/test_service.py::test_unregistered_service PASSED             [ 83%]
tests/core/test_service.py::test_circular_dependency_detection PASSED    [ 83%]
tests/core/test_service.py::test_dependency_validation PASSED            [ 83%]
tests/core/test_service.py::test_invalid_registration PASSED             [ 84%]
tests/core/test_ui.py::test_assert_objc_method_exists_success PASSED     [ 84%]
tests/core/test_ui.py::test_assert_objc_method_exists_failure PASSED     [ 84%]
tests/core/test_ui.py::test_assert_objc_protocol_conformance_success PASSED [ 84%]
tests/core/test_ui.py::test_assert_objc_protocol_conformance_failure PASSED [ 85%]
tests/core/test_ui.py::test_validate_search_field_delegate_true PASSED   [ 85%]
tests/core/test_ui.py::test_validate_search_field_delegate_false PASSED  [ 85%]
tests/core/test_ui.py::test_macos_app_pyobjc_unavailable PASSED          [ 86%]
tests/test_core.py::test_placeholder PASSED                              [ 86%]
tests/test_main.py::test_setup_logging PASSED                            [ 86%]
tests/test_main.py::test_main_success PASSED                             [ 87%]
tests/test_main.py::test_main_error PASSED                               [ 87%]
tests/ui/test_macos_app.py::TestFileSearchApp::test_init_without_pyobjc PASSED [ 87%]
tests/ui/test_macos_app.py::TestFileSearchApp::test_init_with_pyobjc PASSED [ 88%]
tests/ui/test_macos_app.py::TestFileSearchApp::test_set_files PASSED     [ 88%]
tests/ui/test_macos_app.py::TestFileSearchApp::test_search_functions PASSED [ 88%]
tests/ui/test_macos_app.py::TestFileSearchApp::test_search_option_changed PASSED [ 89%]
tests/ui/test_macos_app.py::TestFileSearchApp::test_show_with_pyobjc PASSED [ 89%]
tests/ui/test_macos_app.py::TestFileSearchApp::test_show_without_pyobjc PASSED [ 89%]
tests/ui/test_macos_app.py::test_search_functions PASSED                 [ 90%]
tests/ui/test_macos_app_extended.py::TestImprovedCoverage::test_delegates_creation PASSED [ 90%]
tests/ui/test_macos_app_extended.py::TestImprovedCoverage::test_delegate_methods PASSED [ 90%]
tests/ui/test_macos_app_extended.py::TestImprovedCoverage::test_table_data_source_methods PASSED [ 91%]
tests/ui/test_macos_app_extended.py::TestImprovedCoverage::test_table_delegate_methods PASSED [ 91%]
tests/ui/test_macos_app_extended.py::test_main_function PASSED           [ 91%]
tests/ui/test_objc_integration.py::TestTableViewWrapper::test_create_table_view PASSED [ 92%]
tests/ui/test_objc_integration.py::TestSearchFieldWrapper::test_search_field PASSED [ 92%]
tests/ui/test_objc_integration.py::TestSegmentedControlWrapper::test_segmented_control PASSED [ 92%]
tests/ui/test_objc_integration.py::test_objc_method_validation PASSED    [ 92%]
tests/ui/test_ui_integration.py::TestUIIntegration::test_app_lifecycle FAILED [ 93%]
tests/ui/test_ui_integration.py::TestUIComponentIntegration::test_component_integration FAILED [ 93%]
tests/ui/test_ui_integration.py::TestUIEventIntegration::test_ui_event_integration FAILED [ 93%]

=================================== FAILURES ===================================
_____________________ TestUIIntegration.test_app_lifecycle _____________________

self = <MagicMock name='mock.makeKeyAndOrderFront_' id='4672488160'>

    def assert_called_once(self):
        """assert that the mock was called only once.
        """
        if not self.call_count == 1:
            msg = ("Expected '%s' to have been called once. Called %s times.%s"
                   % (self._mock_name or 'mock',
                      self.call_count,
                      self._calls_repr()))
>           raise AssertionError(msg)
E           AssertionError: Expected 'makeKeyAndOrderFront_' to have been called once. Called 0 times.

../../../.pyenv/versions/3.9.18/lib/python3.9/unittest/mock.py:886: AssertionError

During handling of the above exception, another exception occurred:

self = <test_ui_integration.TestUIIntegration object at 0x110346520>
mock_shared_app = <MagicMock name='sharedApplication' id='4683560176'>
mock_nsapp = <MagicMock name='NSApp' id='4689022544'>

    @patch("AppKit.NSApp")
    @patch("AppKit.NSApplication.sharedApplication")
    def test_app_lifecycle(self, mock_shared_app, mock_nsapp) -> None:
        """Test the show method of FileSearchApp."""
        mock_app = MagicMock()
        mock_shared_app.return_value = mock_app
        app = FileSearchApp()
        app._window = MagicMock()
        app.show()
>       app._window.makeKeyAndOrderFront_.assert_called_once()
E       AssertionError: Expected 'makeKeyAndOrderFront_' to have been called once. Called 0 times.

tests/ui/test_ui_integration.py:146: AssertionError
----------------------------- Captured stdout call -----------------------------
PyObjC not available - UI features disabled
Cannot show UI - PyObjC not available
____________ TestUIComponentIntegration.test_component_integration _____________

self = <test_ui_integration.TestUIComponentIntegration object at 0x1103469d0>
mock_table_alloc = <MagicMock name='alloc' id='4688318864'>
mock_segment_alloc = <MagicMock name='alloc' id='4678616976'>
mock_search_alloc = <MagicMock name='alloc' id='4685076848'>
mock_shared_app = <MagicMock name='sharedApplication' id='4688243008'>
mock_nsapp = <MagicMock name='NSApp' id='4568171760'>

    @patch("AppKit.NSApp")
    @patch("AppKit.NSApplication.sharedApplication")
    @patch("AppKit.NSSearchField.alloc")
    @patch("AppKit.NSSegmentedControl.alloc")
    @patch("AppKit.NSTableView.alloc")
    def test_component_integration(
        self,
        mock_table_alloc,
        mock_segment_alloc,
        mock_search_alloc,
        mock_shared_app,
        mock_nsapp,
    ) -> None:
        """Test UI component instantiation and delegate setup."""
        mock_search_field = MagicMock()
        mock_search_alloc.return_value.init.return_value = mock_search_field
        mock_segment_control = MagicMock()
        mock_segment_alloc.return_value.init.return_value = mock_segment_control
        mock_table_view = MagicMock()
        mock_table_alloc.return_value.init.return_value = mock_table_view
        app = FileSearchApp()
        # Test that the wrappers were instantiated
>       assert hasattr(app, "_search_field")
E       AssertionError: assert False
E        +  where False = hasattr(<panoptikon.ui.macos_app.FileSearchApp object at 0x1173b3c40>, '_search_field')

tests/ui/test_ui_integration.py:184: AssertionError
----------------------------- Captured stdout call -----------------------------
PyObjC not available - UI features disabled
_______________ TestUIEventIntegration.test_ui_event_integration _______________

self = <MagicMock name='mock.makeKeyAndOrderFront_' id='4683776208'>

    def assert_called_once(self):
        """assert that the mock was called only once.
        """
        if not self.call_count == 1:
            msg = ("Expected '%s' to have been called once. Called %s times.%s"
                   % (self._mock_name or 'mock',
                      self.call_count,
                      self._calls_repr()))
>           raise AssertionError(msg)
E           AssertionError: Expected 'makeKeyAndOrderFront_' to have been called once. Called 0 times.

../../../.pyenv/versions/3.9.18/lib/python3.9/unittest/mock.py:886: AssertionError

During handling of the above exception, another exception occurred:

self = <test_ui_integration.TestUIEventIntegration object at 0x110346d60>
mock_shared_app = <MagicMock name='sharedApplication' id='4685487408'>
mock_nsapp = <MagicMock name='NSApp' id='4683927360'>

    @patch("AppKit.NSApp")
    @patch("AppKit.NSApplication.sharedApplication")
    def test_ui_event_integration(self, mock_shared_app, mock_nsapp) -> None:
        """Test that show does not error when PyObjC is available."""
        mock_app = MagicMock()
        mock_shared_app.return_value = mock_app
        app = FileSearchApp()
        app._window = MagicMock()
        app.show()
>       app._window.makeKeyAndOrderFront_.assert_called_once()
E       AssertionError: Expected 'makeKeyAndOrderFront_' to have been called once. Called 0 times.

tests/ui/test_ui_integration.py:209: AssertionError
----------------------------- Captured stdout call -----------------------------
PyObjC not available - UI features disabled
Cannot show UI - PyObjC not available
================================ tests coverage ================================
_______________ coverage: platform darwin, python 3.9.18-final-0 _______________

Name                                        Stmts   Miss  Cover
---------------------------------------------------------------
src/panoptikon/__init__.py                      1      0   100%
src/panoptikon/__main__.py                     34      0   100%
src/panoptikon/core/__init__.py                 0      0   100%
src/panoptikon/core/config.py                 245     37    85%
src/panoptikon/core/errors.py                 178     21    88%
src/panoptikon/core/events.py                 168      9    95%
src/panoptikon/core/lifecycle.py              135      7    95%
src/panoptikon/core/service.py                108      5    95%
src/panoptikon/core/service_extensions.py       7      0   100%
src/panoptikon/database/__init__.py            14      0   100%
src/panoptikon/database/config.py              54      6    89%
src/panoptikon/database/connection.py          87     20    77%
src/panoptikon/database/pool.py               340     59    83%
src/panoptikon/database/pool_service.py        95     12    87%
src/panoptikon/database/schema.py             239     53    78%
src/panoptikon/database/service.py             70      6    91%
src/panoptikon/filesystem/__init__.py           7      0   100%
src/panoptikon/filesystem/access.py           287     50    83%
src/panoptikon/filesystem/bookmarks.py        214     42    80%
src/panoptikon/filesystem/cloud.py            139     12    91%
src/panoptikon/filesystem/events.py           107      3    97%
src/panoptikon/filesystem/paths.py            106     12    89%
src/panoptikon/filesystem/watcher.py          296     77    74%
src/panoptikon/search/__init__.py               0      0   100%
src/panoptikon/typings/__init__.py              0      0   100%
src/panoptikon/ui/__init__.py                   0      0   100%
src/panoptikon/ui/events.py                    77     77     0%
src/panoptikon/ui/macos_app.py                127     26    80%
src/panoptikon/ui/objc_wrappers.py             79     10    87%
src/panoptikon/ui/validators.py                37     15    59%
src/panoptikon/ui/window_interfaces.py         32     32     0%
src/panoptikon/utils/__init__.py                0      0   100%
---------------------------------------------------------------
TOTAL                                        3283    591    82%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
Required test coverage of 80% reached. Total coverage: 82.00%
=========================== short test summary info ============================
FAILED tests/ui/test_ui_integration.py::TestUIIntegration::test_app_lifecycle
FAILED tests/ui/test_ui_integration.py::TestUIComponentIntegration::test_component_integration
FAILED tests/ui/test_ui_integration.py::TestUIEventIntegration::test_ui_event_integration
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 3 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
============ 3 failed, 287 passed, 4 skipped, 7 warnings in 12.51s =============
